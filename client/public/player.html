<!DOCTYPE html>
<html>
<head>
  <title>Spotify Web Playback SDK Quick Start Tutorial</title>
</head>
<body>
  <h1>Spotify Web Playback SDK Quick Start Tutorial</h1>
  <h2>Open your console log: <code>View > Developer > JavaScript Console</code></h2>

  <script src="https://sdk.scdn.co/spotify-player.js"></script>
  <script>
    (function() {
       function getHashParams() {
          var hashParams = {};
          var e, r = /([^&;=]+)=?([^&;]*)/g,
              q = window.location.hash.substring(1);
          while ( e = r.exec(q)) {
             hashParams[e[1]] = decodeURIComponent(e[2]);
          }
          return hashParams;
        }

        var params = getHashParams();

        var access_token = params.access_token,
            refresh_token = params.refresh_token,
            error = params.error;

        localStorage.setItem('spotifyaccesstoken', access_token);
    })();

  </script>
  <script>

  window.onSpotifyPlayerAPIReady = () => {
    const token = localStorage.getItem('spotifyaccesstoken');
    const player = new Spotify.Player({
      name: 'Web Playback SDK Quick Start Player',
      getOAuthToken: cb => { cb(token); }
    });

    // Error handling
    player.on('initialization_error', e => console.error(e));
    player.on('authentication_error', e => console.error(e));
    player.on('account_error', e => console.error(e));
    player.on('playback_error', e => console.error(e));

    // Playback status updates
    player.on('player_state_changed', state => console.log(state));

    // Ready
    player.on('ready', data => {
      console.log('Ready with Device ID', data.device_id);
    });

    // Connect to the player!
    player.connect();

    document.getElementById("play").onclick = function() {
      let token = localStorage.getItem('spotifyaccesstoken');
      let data = JSON.stringify({"context_uri": "spotify:album:5rFZcoCvmCaJ1gxTMU4JTm"});
      var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if(this.readyState == 4 && this.status == 200) {
          console.log(this.responseText);
        }
      }
      xhr.open("PUT", "https://api.spotify.com/v1/me/player/play");
      xhr.setRequestHeader(`Content-type`, `application/x-www-form-urlencoded`);
      xhr.setRequestHeader(`Authorization`, `Bearer ${token}`);
      xhr.send(data);

    }
  }
  </script>
  <button id="play">Play</button>

</body>
</html>